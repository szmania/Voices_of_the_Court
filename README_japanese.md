# Voices of the Court (VOTC)

Crusader Kings III のための AI 搭載コンパニオンで、キャラクター、プロット、ストーリーラインを追跡するのに役立ちます。Voices of the Court は大規模言語モデルをゲームに統合し、キャラクターと自然な会話を交わし、ゲームの状態にダイナミックに影響を与えることができます。

ドキュメント: https://docs.voicesofthecourt.app

[Steam ページ](https://steamcommunity.com/sharedfiles/filedetails/?id=3654567139)

Discord に参加:

[![Discord Server](https://discord.com/api/guilds/1066522056243564585/widget.png?style=banner2)](https://discord.gg/UQpE4mJSqZ)

# トレーラービデオ
[![link to](https://img.youtube.com/vi/E2GmlNsK-J8/0.jpg)](https://www.youtube.com/watch?v=E2GmlNsK-J8)

# DaFloove によるゲームプレイビデオ
[![link to](https://img.youtube.com/vi/3lhHkXPmis0/0.jpg)](https://www.youtube.com/watch?v=3lhHkXPmis0)

### 🌟 機能

### 🎮 設定インターフェース
- **🤖 複数の AI モデル**: OpenAI GPT モデル、Anthropic Claude、Player2、およびローカルモデルのサポート
- **🧠 キャラクターメモリ**: キャラクターの関係や履歴を追跡する永続的なメモリシステム
- **📚 コンテキスト管理**: 調整可能なコンテキストウィンドウと会話履歴の設定
- **🎯 カスタムプロンプト**: キャラクタータイプごとのパーソナライズされたシステムプロンプト
- **🔄 デフォルトに戻す**: プロンプトと設定をワンクリックでデフォルトに復元

### 💬 チャットインターフェース
- **⚡ リアルタイムの会話**: CK3 キャラクターとの自然な対話
- **👤 キャラクタープロフィール**: 各キャラクターに関する詳細情報
- **🔖 ブックマークシステム**: 重要な会話を保存して整理
- **📤 エクスポート機能**: 会話をテキストファイルにエクスポート

### 📋 要約マネージャー
- **🤖 自動要約**: 重要なイベントの AI 生成要約
- **🔖 ブックマーク統合**: ブックマークを要約に変換
- **🔍 検索機能**: 特定の会話や要約を検索
- **📤 エクスポートオプション**: 要約をさまざまな形式で保存

## 設定インターフェースの詳細

アプリケーションには 6 つの主要な設定ページがあり、それぞれが異なる機能設定を担当します。

### 1. 接続ページ

接続ページは、言語モデル API への接続とゲームパスの設定を構成するために使用されます。

- **API 接続構成**:
  - テキスト生成 API プロバイダー（OpenAI、Kobold など）を選択
  - API キー、エンドポイント URL、モデル名を構成

- **CK3 ユーザーフォルダのパス**:
  - ユーザーデータが保存されている CK3 フォルダパスを設定
  - デフォルトパス: `User Documents/Paradox Interactive/Crusader Kings III`
  - 「フォルダを選択」ボタンから正しいパスを参照して選択可能

### 2. アクションページ

アクションページは、ゲーム内で検出可能なアクションと対応する AI の応答を構成するために使用されます。

- **アクションを有効にする**:
  - アクション検出を有効にするかどうかを制御するマスタースイッチ
  - AI ナラティブを有効にする: アクションがトリガーされた後に AI ナラティブの説明を生成

- **API 構成**:
  - 接続ページと同じ API 設定を使用することを選択
  - または、アクション機能用に個別の API を構成

- **パラメーター設定**:
  - 温度 (Temperature): AI 応答の創造性を制御（デフォルト 0.2、低い値ほど応答が確定的になります）
  - 頻度ペナルティ (Frequency Penalty): 繰り返しのコンテンツの生成を減らす
  - 存在ペナルティ (Presence Penalty): 新しいトピックについて話すことを奨励
  - Top P: 語彙選択の多様性を制御

- **アクション選択**:
  - モッドに検出させたいアクションのタイプをリストから選択
  - 各アクションには説明と作成者情報があります
  - 「ファイルを再読み込み」ボタンでアクションリストを更新
  - 「フォルダを開く」ボタンからカスタムアクションスクリプトにアクセス

### 3. 要約ページ

要約ページは、会話要約機能の API 設定を構成するために使用されます。

- **API 構成**:
  - 接続ページと同じ API 設定を使用することを選択
  - または、要約機能用に個別の API を構成

- **パラメーター設定**:
  - 温度 (Temperature): 要約の創造性を制御（デフォルト 0.2）
  - 頻度ペナルティ (Frequency Penalty): 要約内の繰り返しのコンテンツを減らす
  - 存在ペナルティ (Presence Penalty): 新しい情報の包含を奨励
  - Top P: 語彙選択の多様性を制御

要約機能は、長い会話を短い要約に圧縮し、会話のコンテキストをトークン制限内に維持し、将来の参照のために会話後に要約を生成するために使用されます。

### 4. プロンプトページ

プロンプトページは、AI と対話するためのさまざまなプロンプトとスクリプトを構成するために使用されます。

- **主要なプロンプト**:
  - メインプロンプト: AI がどのように応答するかを制御する基本命令
  - 独り言プロンプト: キャラクターの内なる独白の生成ルール
  - 要約プロンプト: 会話の要約を生成するための命令
  - 独り言要約プロンプト: キャラクターの内なる独白の要約ルール
  - 記憶プロンプト: キャラクターが過去のイベントをどのように記憶し、参照するか
  - サフィックスプロンプト: API リクエストの前に挿入される最後のシステムメッセージ。モデルの応答フォーマットをガイドするために使用
  - ナラティブプロンプト: アクションがトリガーされた後に AI ナラティブの説明を生成するためのルール

- **スクリプト選択**:
  - キャラクター説明スクリプト: キャラクターの説明を動的に生成するためのスクリプト
  - メッセージ例スクリプト: 会話メッセージの例を生成するためのスクリプト
  - プレイブック: インポートに使用される特定のプレイブックファイル。世界観とキャラクター設定が含まれています

各スクリプトには標準バージョンとカスタムバージョンがあり、ドロップダウンメニューで選択でき、「フォルダを開く」ボタンからアクセスできます。

### 5. 設定ページ

設定ページには、アプリケーションのさまざまな動作および生成パラメーターの構成が含まれています。

- **基本設定**:
  - 最大新規トークン数: 単一の AI 応答の最大長を制限
  - 最大メモリトークン数: キャラクターの記憶の最大長を制限
  - メッセージをストリーム: ストリーム応答（AI 生成のリアルタイム表示）を有効/無効
  - メッセージをクリーンアップ: AI 生成から不要なコンテンツ（絵文字など）を削除しようとする
  - キャラクターの順序をシャッフル: 複数人の会話でキャラクターの話し順をランダム化
  - ダイナミックなキャラクター選択: LLM を使用して会話を分析し、次に話すキャラクターを選択
  - キャラクターのアイデンティティを検証: 生成されたメッセージがキャラクターのアイデンティティと一致することを確認し、LLM が他のキャラクターの返信を生成するのを防ぐ
  - 提案ボタンを表示: チャットウィンドウの推奨入力ステートメント機能を表示/非表示

- **挿入深度設定**:
  - 要約の挿入深度: 会話履歴内の要約の挿入位置を制御
  - 記憶の挿入深度: 会話履歴内のキャラクターの記憶の挿入位置を制御
  - キャラクター説明の挿入深度: 会話履歴内のキャラクター説明の挿入位置を制御

- **命令設定**:
  - 入力シーケンス: ユーザー入力をマークするための特別なマーカー
  - 出力シーケンス: AI 出力をマークするための特別なマーカー

- **テキスト生成パラメーター**:
  - 温度 (Temperature): AI 応答の創造性を制御（デフォルト 0.8）
  - 頻度ペナルティ (Frequency Penalty): 繰り返しのコンテンツの生成を減らす
  - 存在ペナルティ (Presence Penalty): 新しいトピックについて話すことを奨励
  - Top P: 語彙選択の多様性を制御（デフォルト 0.9）

### 6. システムページ

システムページは、アプリケーションのメンテナンスとコミュニティリンク機能を提供します。

- **アップデート機能**:
  - 現在のアプリケーションバージョンを表示
  - アップデートを確認ボタン: 新しいバージョンを手動で確認
  - 起動時にアップデートを確認: アプリの起動時にアップデートを自動的に確認

- **ログファイル**:
  - エラーやクラッシュが発生した場合は、ログファイルを表示可能
  - ログフォルダを開くボタン: ログファイルに直接アクセス

- **会話要約管理**:
  - 要約を消去ボタン: すべてのキャラクターの以前の会話要約を削除
  - 会話要約フォルダを開くボタン: 保存された会話要約にアクセス

## チャットインターフェース機能

チャットインターフェースは、ゲームキャラクターと対話するための主要なインターフェースであり、以下の機能が含まれています。

- **メッセージ表示**:
  - プレイヤーメッセージと AI キャラクターメッセージは異なるスタイルで表示されます
  - 基本的な Markdown フォーマット（太字、斜体）をサポート
  - ナラティブメッセージは特別なスタイルで表示され、シーンの説明を提供します

- **入力機能**:
  - テキスト入力ボックス: キャラクターとの対話内容を入力
  - Enter キーでメッセージを送信
  - 複数行の入力をサポート

- **提案機能**（構成可能）:
  - 提案ボタン: 推奨される入力ステートメントを表示
  - 提案リスト: 提案をクリックすると、入力ボックスに自動的に入力されます
  - 閉じるボタン: 提案パネルを非表示にします

- **対話制御**:
  - 会話終了ボタン: 現在の対話を終了

- **ステータスインジケーター**:
  - 読み込み中: AI が応答を生成していることを示します
  - エラーメッセージ: 接続または生成エラーを表示します

## 要約マネージャー機能

要約マネージャーは、ゲームキャラクターの会話要約を管理および編集するためのインターフェースであり、以下の機能を提供します。

### 上部コントロールボタン

- **更新ボタン**: ゲームログからのプレイヤー ID の解析や要約ファイルの読み込みを含む、すべての要約データを再読み込み
- **保存ボタン**: 現在のすべての要約の変更をファイルに保存
- **閉じるボタン**: 要約マネージャーウィンドウを閉じる

### 情報パネル

- **プレイヤー ID**: ゲームログから解析された現在のプレイヤー ID を表示（読み取り専用）
- **キャラクターを選択**: 特定のキャラクターの要約をフィルタリングするか、すべてを表示するためのドロップダウンメニュー
- **要約ファイルのパス**: 現在の要約ファイルの保存パスを表示（読み取り専用）

### 要約リストエリア

- **要約リスト**: 現在のフィルター下のすべての要約を表示し、それぞれに日付、キャラクター、内容が含まれます
- **新しい要約を追加ボタン**: リストの先頭に新しい空白の要約を作成し、デフォルトで選択されたキャラクターを使用します

### エディターエリア

- **日付入力ボックス**: 現在選択されている要約の日付を編集
- **内容テキストボックス**: 現在選択されている要約の詳細な内容を編集
- **要約を更新ボタン**: 現在選択されている要約への変更を保存
- **要約を削除ボタン**: 現在選択されている要約を削除（確認が必要）
- **新規要約ボタン**: エディターをクリアして新しい要約を準備

### 使用方法

1. リスト内の要約をクリックして選択し、エディターに読み込みます
2. キャラクターフィルターを使用して、特定のキャラクターまたはすべてのキャラクターの要約を表示します
3. すべての変更は、「保存」ボタンをクリックしてファイルに書き込む必要があります
4. 削除は元に戻せません。注意して使用してください

## 🚀 ローカルセットアップ

### 📥 インストール
1. VOTC モッドの最新バージョンをダウンロード
2. CK3 モッドフォルダに解凍
3. CK3 を起動し、ランチャーでモッドを有効にする
4. VOTC アプリケーションを実行

### ⚙️ 設定
1. アプリケーションを起動
2. 設定インターフェースに移動
3. AI サービスの API キーを入力
4. 好みに合わせて設定を調整
5. 「設定を保存」をクリックして変更を適用

### 🔄 デフォルト設定を復元
- 「デフォルトのプロンプトを復元」ボタンを使用して、すべてのデフォルトプロンプト設定をワンクリックで復元
- 個々の設定項目は設定インターフェースでリセット可能

## 🛠️ トラブルシューティング

### 🔧 よくある質問

#### 1. **アプリケーションが起動しない**
   - すべての依存関係がインストールされていることを確認: `npm install` を実行
   - Node.js のバージョンが互換性があるか確認
   - ゲームファイルのパスが正しいか確認

#### 2. **AI 接続の問題**
   - API キーが正しく入力されているか確認
   - ネットワーク接続が正常か確認
   - AI プロバイダーの API ステータスを確認

#### 3. **ゲーム統合の問題**
   - CK3 ゲームが実行されていることを確認
   - モッドが正しくインストールされているか確認
   - ゲームファイルのパス設定を確認

#### 4. **パフォーマンスの問題**
   - コンテキストウィンドウのサイズを小さくする
   - 会話履歴の記録数を制限する
   - 不要なバックグラウンドプログラムを閉じる

#### 5. **デフォルト設定を復元**
   - 設定インターフェースの「デフォルトのプロンプトを復元」ボタンを使用
   - API 設定とモデルパラメーターを再構成
   - 設定ファイルが正しく保存されているか確認

## 🤝 貢献

プロジェクトへの貢献は以下を通じて歓迎されます：
- バグ報告や機能リクエストの提案

### 📝 貢献ガイドライン
1. このリポジトリをフォークする
2. フィーチャーブランチを作成する (`git checkout -b feature/AmazingFeature`)
3. 変更をコミットする (`git commit -m 'Add some AmazingFeature'`)
4. ブランチにプッシュする (`git push origin feature/AmazingFeature`)
5. プルリクエストを作成する

### 📄 ライセンス

このプロジェクトは [GPL-3.0 ライセンス](LICENSE) の下でライセンスされています。詳細は [LICENSE](LICENSE) ファイルを参照してください。

### 🛠️ ローカル開発セットアップ

1. リポジトリをクローン
2. `npm i` で依存関係をインストール
3. `npm run start` で開発モードを開始
4. `npm run make` でアプリをパッケージ化

Electron のバージョン問題の修正：
```
npx electron-rebuild
```

# Voices of the Court (VOTC)

Crusader Kings III를 위한 AI 기반 동반자로, 캐릭터, 음모 및 스토리라인을 추적하는 데 도움을 줍니다. Voices of the Court는 대규모 언어 모델을 게임에 통합하여 캐릭터와 자연스러운 대화를 나누고 게임 상태에 동적으로 영향을 줄 수 있도록 합니다.

문서: https://docs.voicesofthecourt.app

[Steam 페이지](https://steamcommunity.com/sharedfiles/filedetails/?id=3654567139)

Discord 참여:

[![Discord Server](https://discord.com/api/guilds/1066522056243564585/widget.png?style=banner2)](https://discord.gg/UQpE4mJSqZ)

# 트레일러 비디오
[![link to](https://img.youtube.com/vi/E2GmlNsK-J8/0.jpg)](https://www.youtube.com/watch?v=E2GmlNsK-J8)

# DaFloove의 게임플레이 비디오
[![link to](https://img.youtube.com/vi/3lhHkXPmis0/0.jpg)](https://www.youtube.com/watch?v=3lhHkXPmis0)

### 🌟 기능

### 🎮 설정 인터페이스
- **🤖 다양한 AI 모델**: OpenAI GPT 모델, Anthropic Claude, Player2 및 로컬 모델 지원
- **🧠 캐릭터 기억**: 캐릭터 관계 및 기록을 추적하는 영구 메모리 시스템
- **📚 컨텍스트 관리**: 조정 가능한 컨텍스트 창 및 대화 기록 설정
- **🎯 사용자 정의 프롬프트**: 캐릭터 유형별 개인화된 시스템 프롬프트
- **🔄 기본값 복원**: 클릭 한 번으로 프롬프트 및 설정을 기본값으로 복원

### 💬 채팅 인터페이스
- **⚡ 실시간 대화**: CK3 캐릭터와의 자연스러운 대화
- **👤 캐릭터 프로필**: 각 캐릭터에 대한 상세 정보
- **🔖 북마크 시스템**: 중요한 대화 저장 및 정리
- **📤 내보내기 기능**: 대화를 텍스트 파일로 내보내기

### 📋 요약 관리자
- **🤖 자동 요약**: 중요한 이벤트의 AI 생성 요약
- **🔖 북마크 통합**: 북마크를 요약으로 변환
- **🔍 검색 기능**: 특정 대화 및 요약 찾기
- **📤 내보내기 옵션**: 요약을 다양한 형식으로 저장

## 설정 인터페이스 상세

애플리케이션은 6개의 주요 설정 페이지를 제공하며, 각 페이지는 서로 다른 기능 설정을 담당합니다.

### 1. 연결 페이지

연결 페이지는 언어 모델 API와의 연결 및 게임 경로 설정을 구성하는 데 사용됩니다.

- **API 연결 구성**:
  - 텍스트 생성 API 제공업체 선택(예: OpenAI, Kobold 등)
  - API 키, 엔드포인트 URL 및 모델 이름 구성

- **CK3 사용자 폴더 경로**:
  - 사용자 데이터가 저장된 CK3 폴더 경로 설정
  - 기본 경로: `User Documents/Paradox Interactive/Crusader Kings III`
  - "폴더 선택" 버튼을 통해 올바른 경로를 찾아 선택할 수 있습니다.

### 2. 작업 페이지

작업 페이지는 게임 내에서 감지 가능한 작업과 해당 AI 응답을 구성하는 데 사용됩니다.

- **작업 활성화**:
  - 작업 감지 활성화 여부를 제어하는 마스터 스위치
  - AI 내러티브 활성화: 작업이 트리거된 후 AI 내러티브 설명 생성

- **API 구성**:
  - 연결 페이지와 동일한 API 설정 사용 선택
  - 또는 작업 기능을 위한 별도의 API 구성

- **매개변수 설정**:
  - 온도(Temperature): AI 응답의 창의성 제어(기본값 0.2, 값이 낮을수록 응답이 더 결정적임)
  - 빈도 페널티(Frequency Penalty): 반복되는 콘텐츠 생성 감소
  - 존재 페널티(Presence Penalty): 새로운 주제에 대한 대화 장려
  - Top P: 어휘 선택의 다양성 제어

- **작업 선택**:
  - 모드가 감지할 작업 유형을 목록에서 선택
  - 각 작업에는 설명과 제작자 정보가 있습니다.
  - "파일 새로고침" 버튼으로 작업 목록 업데이트
  - "폴더 열기" 버튼을 통해 사용자 정의 작업 스크립트 액세스

### 3. 요약 페이지

요약 페이지는 대화 요약 기능을 위한 API 설정을 구성하는 데 사용됩니다.

- **API 구성**:
  - 연결 페이지와 동일한 API 설정 사용 선택
  - 또는 요약 기능을 위한 별도의 API 구성

- **매개변수 설정**:
  - 온도(Temperature): 요약의 창의성 제어(기본값 0.2)
  - 빈도 페널티(Frequency Penalty): 요약에서 반복되는 콘텐츠 감소
  - 존재 페널티(Presence Penalty): 새로운 정보 포함 장려
  - Top P: 어휘 선택의 다양성 제어

요약 기능은 긴 대화를 짧은 요약으로 압축하여 대화 컨텍스트를 토큰 제한 내로 유지하고, 대화 종료 후 향후 참조를 위해 요약을 생성하는 데 사용됩니다.

### 4. 프롬프트 페이지

프롬프트 페이지는 AI와 상호 작용하기 위한 다양한 프롬프트 및 스크립트를 구성하는 데 사용됩니다.

- **주요 프롬프트**:
  - 메인 프롬프트: AI가 응답하는 방식을 제어하는 기본 지침
  - 혼잣말 프롬프트: 캐릭터 내면 독백 생성 규칙
  - 요약 프롬프트: 대화 요약 생성을 위한 지침
  - 혼잣말 요약 프롬프트: 캐릭터 내면 독백 요약 규칙
  - 기억 프롬프트: 캐릭터가 과거 이벤트를 기억하고 참조하는 방식
  - 접미사 프롬프트: API 요청 전에 삽입되는 마지막 시스템 메시지로, 모델의 응답 형식 안내에 사용
  - 내러티브 프롬프트: 작업이 트리거된 후 AI 내러티브 설명을 생성하기 위한 규칙

- **스크립트 선택**:
  - 캐릭터 설명 스크립트: 캐릭터 설명을 동적으로 생성하기 위한 스크립트
  - 예시 메시지 스크립트: 예시 대화 메시지를 생성하기 위한 스크립트
  - 플레이북: 세계관 및 캐릭터 설정이 포함된 가져오기용 특정 플레이북 파일

각 스크립트는 표준 및 사용자 정의 버전이 있으며, 드롭다운 메뉴를 통해 선택하고 "폴더 열기" 버튼을 통해 액세스할 수 있습니다.

### 5. 설정 페이지

설정 페이지에는 애플리케이션의 다양한 동작 및 생성 매개변수 구성이 포함되어 있습니다.

- **기본 설정**:
  - 최대 새 토큰: 단일 AI 응답의 최대 길이 제한
  - 최대 메모리 토큰: 캐릭터 기억의 최대 길이 제한
  - 메시지 스트림: 스트림 응답(AI 생성 실시간 표시) 활성화/비활성화
  - 메시지 정리: AI 생성에서 원치 않는 콘텐츠(예: 이모지) 제거 시도
  - 캐릭터 순서 섞기: 다인 대화에서 캐릭터 발언 순서 무작위화
  - 동적 캐릭터 선택: LLM을 사용하여 대화를 분석하고 다음에 응답할 캐릭터 선택
  - 캐릭터 정체성 검증: 생성된 메시지가 캐릭터 정체성과 일치하는지 확인하여 LLM이 다른 캐릭터의 답장을 생성하는 것을 방지
  - 제안 버튼 표시: 채팅 창에서 권장 입력 문구 기능 표시/숨기기

- **삽입 깊이 설정**:
  - 요약 삽입 깊이: 대화 기록 내 요약 삽입 위치 제어
  - 기억 삽입 깊이: 대화 기록 내 캐릭터 기억 삽입 위치 제어
  - 캐릭터 설명 삽입 깊이: 대화 기록 내 캐릭터 설명 삽입 위치 제어

- **지침 설정**:
  - 입력 시퀀스: 사용자 입력을 표시하기 위한 특수 마커
  - 출력 시퀀스: AI 출력을 표시하기 위한 특수 마커

- **텍스트 생성 매개변수**:
  - 온도(Temperature): AI 응답의 창의성 제어(기본값 0.8)
  - 빈도 페널티(Frequency Penalty): 반복되는 콘텐츠 생성 감소
  - 존재 페널티(Presence Penalty): 새로운 주제에 대한 대화 장려
  - Top P: 어휘 선택의 다양성 제어(기본값 0.9)

### 6. 시스템 페이지

시스템 페이지는 애플리케이션 유지 관리 및 커뮤니티 링크 기능을 제공합니다.

- **업데이트 기능**:
  - 현재 애플리케이션 버전 표시
  - 업데이트 확인 버튼: 수동으로 새 버전 확인
  - 시작 시 업데이트 확인: 앱 시작 시 자동으로 업데이트 확인

- **로그 파일**:
  - 오류/충돌 발생 시 로그 파일 확인 가능
  - 로그 폴더 열기 버튼: 로그 파일에 직접 액세스

- **대화 요약 관리**:
  - 요약 지우기 버튼: 모든 캐릭터의 이전 대화 요약 삭제
  - 대화 요약 폴더 열기 버튼: 저장된 대화 요약에 액세스

## 채팅 인터페이스 기능

채팅 인터페이스는 게임 캐릭터와 상호 작용하기 위한 기본 인터페이스이며 다음 기능을 포함합니다.

- **메시지 표시**:
  - 플레이어 메시지와 AI 캐릭터 메시지가 서로 다른 스타일로 표시됨
  - 기본 Markdown 형식(굵게, 기울임꼴) 지원
  - 내러티브 메시지는 특별한 스타일로 표시되어 장면 설명 제공

- **입력 기능**:
  - 텍스트 입력란: 캐릭터와의 대화 내용 입력
  - Enter 키로 메시지 전송
  - 다행 입력 지원

- **제안 기능**(구성 가능):
  - 제안 버튼: 권장 입력 문구 표시
  - 제안 목록: 제안을 클릭하면 입력란에 자동으로 채워짐
  - 닫기 버튼: 제안 패널 숨기기

- **대화 제어**:
  - 대화 종료 버튼: 현재 대화 종료

- **상태 표시기**:
  - 로딩 중: AI가 응답을 생성 중임을 표시
  - 오류 메시지: 연결 또는 생성 오류 표시

## 요약 관리자 기능

요약 관리자는 게임 캐릭터 대화 요약을 관리하고 편집하기 위한 인터페이스이며 다음 기능을 제공합니다.

### 상단 제어 버튼

- **새로고침 버튼**: 게임 로그에서 플레이어 ID 파싱 및 요약 파일 읽기를 포함하여 모든 요약 데이터 다시 로드
- **저장 버튼**: 현재 모든 요약 변경 사항을 파일에 저장
- **닫기 버튼**: 요약 관리자 창 닫기

### 정보 패널

- **플레이어 ID**: 게임 로그에서 파싱된 현재 플레이어 ID 표시(읽기 전용)
- **캐릭터 선택**: 특정 캐릭터의 요약을 필터링하거나 모두 보기 위한 드롭다운 메뉴
- **요약 파일 경로**: 현재 요약 파일의 저장 경로 표시(읽기 전용)

### 요약 목록 영역

- **요약 목록**: 현재 필터 아래의 모든 요약을 표시하며, 각 요약에는 날짜, 캐릭터 및 내용이 포함됨
- **새 요약 추가 버튼**: 목록 상단에 새로운 빈 요약을 생성하며, 기본적으로 선택된 캐릭터 사용

### 편집기 영역

- **날짜 입력란**: 현재 선택된 요약의 날짜 편집
- **내용 텍스트 상자**: 현재 선택된 요약의 세부 내용 편집
- **요약 업데이트 버튼**: 현재 선택된 요약에 대한 변경 사항 저장
- **요약 삭제 버튼**: 현재 선택된 요약 삭제(확인 필요)
- **새 요약 버튼**: 편집기를 비우고 새 요약 준비

### 사용 방법

1. 목록에서 요약을 클릭하여 선택하고 편집기에 로드합니다.
2. 캐릭터 필터를 사용하여 특정 캐릭터 또는 모든 캐릭터의 요약을 봅니다.
3. 모든 변경 사항은 "저장" 버튼을 클릭하여 파일에 기록해야 합니다.
4. 삭제는 취소할 수 없으므로 주의해서 사용하세요.

## 🚀 로컬 설정

### 📥 설치
1. VOTC 모드 최신 버전 다운로드
2. CK3 모드 폴더에 압축 해제
3. CK3를 실행하고 런처에서 모드 활성화
4. VOTC 애플리케이션 실행

### ⚙️ 설정
1. 애플리케이션 실행
2. 설정 인터페이스로 이동
3. AI 서비스 API 키 입력
4. 취향에 맞게 설정 조정
5. "설정 저장"을 클릭하여 변경 사항 적용

### 🔄 기본 설정 복원
- "기본 프롬프트 복원" 버튼을 사용하여 모든 기본 프롬프트 설정을 클릭 한 번으로 복원
- 개별 설정 항목은 설정 인터페이스에서 재설정 가능

## 🛠️ 문제 해결

### 🔧 일반적인 문제

#### 1. **애플리케이션 실행 실패**
   - 모든 종속성이 설치되었는지 확인: `npm install` 실행
   - Node.js 버전이 호환되는지 확인
   - 게임 파일 경로가 올바른지 확인

#### 2. **AI 연결 문제**
   - API 키가 올바르게 입력되었는지 확인
   - 네트워크 연결이 정상인지 확인
   - AI 제공업체의 API 상태 확인

#### 3. **게임 통합 문제**
   - CK3 게임이 실행 중인지 확인
   - 모드가 올바르게 설치되었는지 확인
   - 게임 파일 경로 설정 확인

#### 4. **성능 문제**
   - 컨텍스트 창 크기 축소
   - 대화 기록 레코드 수 제한
   - 불필요한 백그라운드 프로그램 종료

#### 5. **기본 설정 복원**
   - 설정 인터페이스의 "기본 프롬프트 복원" 버튼 사용
   - API 설정 및 모델 매개변수 재구성
   - 설정 파일이 올바르게 저장되었는지 확인

## 🤝 기여

프로젝트 기여는 다음을 통해 환영합니다.
- 버그 보고 및 기능 요청 제안

### 📝 기여 가이드라인
1. 이 저장소 포크
2. 기능 브랜치 생성(`git checkout -b feature/AmazingFeature`)
3. 변경 사항 커밋(`git commit -m 'Add some AmazingFeature'`)
4. 브랜치에 푸시(`git push origin feature/AmazingFeature`)
5. 풀 리퀘스트 생성

### 📄 라이선스

이 프로젝트는 [GPL-3.0 라이선스](LICENSE)에 따라 라이선스가 부여됩니다. 자세한 내용은 [LICENSE](LICENSE) 파일을 참조하세요.

### 🛠️ 로컬 개발 설정

1. 저장소 클론
2. `npm i`로 종속성 설치
3. `npm run start`로 개발 모드 시작
4. `npm run make`로 앱 패키징

Electron 버전 문제 해결:
```
npx electron-rebuild
```
# Implementation Plan: Add German, Japanese, Korean, and Polish Languages

## 1. Summary / Overview

**Problem**: The application currently supports only 5 languages (English, Chinese, Russian, French, Spanish), limiting accessibility for users who speak German, Japanese, Korean, or Polish.

**Goal**: Add support for four new languages (German, Japanese, Korean, Polish) to make the application more accessible to a wider international audience.

**Why Needed**: 
- German, Japanese, Korean, and Polish are widely spoken languages with significant user bases
- Expanding language support increases user adoption and satisfaction
- Improves accessibility for non-English speaking players
- Aligns with the international nature of Crusader Kings III player base

**Outcomes**:
- Users can select German, Japanese, Korean, or Polish as their interface language
- All UI elements and prompts are properly translated
- Language selection dropdown includes all 9 supported languages
- Configuration files support the new languages

## 2. Design Requirements

**User Needs**:
- Users should be able to select German, Japanese, Korean, or Polish as their preferred language
- All UI elements should be properly translated in the selected language
- Language switching should work seamlessly without application restart

**Software Needs**:
- Create new locale files for German, Japanese, Korean, and Polish
- Update default_config.json to include new language configurations
- Update LanguageSelector.ts component to add new languages to dropdown
- Ensure all existing functionality works with new languages

**Compatibility Requirements**:
- Must integrate with existing localization system
- Should work with current LanguageSelector component structure
- Must not break existing language functionality
- Should respect existing file naming conventions

**Performance Requirements**:
- No performance impact from additional languages
- Language files should load efficiently
- Language switching should be instantaneous

## 3. Design Specification

### 3.1 Language Codes and File Structure

**Language Codes**:
- German: `de` (ISO 639-1 code)
- Japanese: `ja` (ISO 639-1 code)
- Korean: `ko` (ISO 639-1 code)
- Polish: `pl` (ISO 639-1 code)

**File Structure**:
```
public/locales/
├── en.json    (existing)
├── zh.json    (existing)
├── ru.json    (existing)
├── fr.json    (existing)
├── es.json    (existing)
├── de.json    (new - German)
├── ja.json    (new - Japanese)
├── ko.json    (new - Korean)
└── pl.json    (new - Polish)
```

### 3.2 Configuration Updates

**default_config.json Updates**:
- Add German, Japanese, Korean, Polish prompt configurations
- Follow existing pattern for language-specific prompts
- Include all required prompt types for each language

**LanguageSelector.ts Updates**:
- Add German, Japanese, Korean, Polish to dropdown list
- Add appropriate flag SVGs for each language
- Maintain alphabetical order in dropdown
- Ensure proper language code mapping

### 3.3 Translation Strategy

**Initial Translation Approach**:
1. Use English as base translation template
2. Create placeholder translations initially (can be filled by translators later)
3. Ensure all translation keys are present in each new language file
4. Maintain consistent JSON structure across all language files

**Translation Keys**:
- All new language files must contain exactly the same keys as English locale
- Missing keys will fall back to English
- Keys should be organized in the same hierarchical structure

## 4. Implementation Steps

### Step 1: Analyze Current Language Structure (✅ Completed)
- Review existing locale files structure
- Understand LanguageSelector.ts component
- Examine default_config.json language configuration pattern

### Step 2: Create German Locale File (✅ Completed)

### Step 3: Create Japanese Locale File (✅ Completed)
```json
// public/locales/ja.json
{
  "app": {
    "title": "Voices of the Court - Community Edition"
  },
  "nav": {
    "connection": "接続",
    "actions": "アクション",
    "summarization": "要約",
    "prompts": "プロンプト",
    "settings": "設定",
    "system": "システム",
    "help": "ヘルプ"
  },
  // ... continue with all keys from en.json
}
```

### Step 4: Create Korean Locale File (✅ Completed)

### Step 5: Create Polish Locale File (✅ Completed)

### Step 6: Update default_config.json (✅ Completed)

### Step 7: Update LanguageSelector.ts (✅ Completed)

### Step 8: Test Language Integration (✅ Completed)
private getFlagSvg(lang: string): string {
    if (lang === 'en') {
        return `<svg ...>English flag SVG</svg>`;
    } else if (lang === 'zh') {
        return `<svg ...>Chinese flag SVG</svg>`;
    } else if (lang === 'ru') {
        return `<svg ...>Russian flag SVG</svg>`;
    } else if (lang === 'fr') {
        return `<svg ...>French flag SVG</svg>`;
    } else if (lang === 'es') {
        return `<svg ...>Spanish flag SVG</svg>`;
    } else if (lang === 'de') {
        return `<svg ...>German flag SVG</svg>`;
    } else if (lang === 'ja') {
        return `<svg ...>Japanese flag SVG</svg>`;
    } else if (lang === 'ko') {
        return `<svg ...>Korean flag SVG</svg>`;
    } else if (lang === 'pl') {
        return `<svg ...>Polish flag SVG</svg>`;
    } else {
        return '';
    }
}

// Update the connectedCallback method to include new languages in dropdown
this.innerHTML = `
    <div class="dropdown">
        <button class="dropbtn" id="current-language-btn">
            ${this.getFlagSvg(lang)}
            <span class="lang-text">${lang === 'en' ? 'English' : lang === 'zh' ? '中文' : lang === 'ru' ? 'Русский' : lang === 'fr' ? 'Français' : lang === 'es' ? 'Español' : lang === 'de' ? 'Deutsch' : lang === 'ja' ? '日本語' : lang === 'ko' ? '한국어' : 'Polski'}</span>
        </button>
        <div class="dropdown-content" id="language-dropdown">
            <a href="#" data-lang="en">
                ${this.getFlagSvg('en')}
                <span class="lang-text">English</span>
            </a>
            <a href="#" data-lang="zh">
                ${this.getFlagSvg('zh')}
                <span class="lang-text">中文</span>
            </a>
            <a href="#" data-lang="ru">
                ${this.getFlagSvg('ru')}
                <span class="lang-text">Русский</span>
            </a>
            <a href="#" data-lang="fr">
                ${this.getFlagSvg('fr')}
                <span class="lang-text">Français</span>
            </a>
            <a href="#" data-lang="es">
                ${this.getFlagSvg('es')}
                <span class="lang-text">Español</span>
            </a>
            <a href="#" data-lang="de">
                ${this.getFlagSvg('de')}
                <span class="lang-text">Deutsch</span>
            </a>
            <a href="#" data-lang="ja">
                ${this.getFlagSvg('ja')}
                <span class="lang-text">日本語</span>
            </a>
            <a href="#" data-lang="ko">
                ${this.getFlagSvg('ko')}
                <span class="lang-text">한국어</span>
            </a>
            <a href="#" data-lang="pl">
                ${this.getFlagSvg('pl')}
                <span class="lang-text">Polski</span>
            </a>
        </div>
    </div>
`;

// Update the updateButtonText method
updateButtonText(btn: HTMLElement, lang: string) {
    const text = lang === 'en' ? 'English' : 
                 lang === 'zh' ? '中文' : 
                 lang === 'ru' ? 'Русский' : 
                 lang === 'fr' ? 'Français' : 
                 lang === 'es' ? 'Español' : 
                 lang === 'de' ? 'Deutsch' : 
                 lang === 'ja' ? '日本語' : 
                 lang === 'ko' ? '한국어' : 
                 'Polski';
    btn.innerHTML = `
        ${this.getFlagSvg(lang)}
        <span class="lang-text">${text}</span>
    `;
}
```

### Step 8: Test Language Integration
- Verify all new locale files load correctly
- Test language switching functionality
- Ensure all UI elements display translated text
- Check for missing translation keys

### Step 9: Update Documentation
- Update README files to mention new language support
- Update any configuration documentation
- Add translation contribution guidelines

## 5. Clarifying Questions

**ANSWER**: Based on the existing language implementation:

1. **Language Codes**: Use ISO 639-1 codes (de, ja, ko, pl) as specified.
2. **Translation Completeness**: Initial implementation can use English as placeholder; actual translations can be added later.
3. **Flag SVGs**: Need to create appropriate flag SVGs for each new language.
4. **Order in Dropdown**: Add new languages at the bottom of the dropdown in the order: German, Japanese, Korean, Polish.

## 6. Feedback and Iteration

**Testing Strategy**:
1. Unit tests for language file loading
2. Integration tests for language switching
3. UI testing for proper display of translated text

**Iteration Points**:
- Improve flag SVG designs if needed
- Add more complete translations over time
- Optimize language file loading if performance issues arise

## 7. Assumptions

1. **File Structure**: New locale files follow same JSON structure as existing ones
2. **Component Compatibility**: LanguageSelector.ts can handle additional languages without modification to core logic
3. **Configuration Compatibility**: default_config.json can accommodate additional language configurations
4. **Performance**: Adding 4 more language files won't impact application performance

## 8. Risk Assessment

**Risks**:
1. Missing translation keys causing English fallback
2. Flag SVG rendering issues
3. Configuration file syntax errors
4. Language switching performance issues

**Mitigations**:
1. Use English as base template for all new locale files
2. Test SVG rendering in different browsers
3. Validate JSON syntax before committing
4. Profile language switching performance

## 9. Success Criteria

1. ✅ German, Japanese, Korean, Polish appear in language dropdown
2. ✅ Users can select and switch to new languages
3. ✅ All UI elements display translated text (or English fallback)
4. ✅ Configuration files include new language prompts
5. ✅ No breaking changes to existing functionality

## 10. Timeline Estimate

**Phase 1 (Analysis & File Creation)**: 1-2 days
**Phase 2 (Configuration Updates)**: 1 day
**Phase 3 (Component Updates)**: 1 day
**Phase 4 (Testing & Refinement)**: 1-2 days
**Total**: 4-6 days of development time
